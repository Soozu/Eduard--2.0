<!DOCTYPE html>

<html>
    <head>
        
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>WerTigo</title>

        <!-- FONT AWESOME -->
         <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" class="stylesheet">
         <link rel="stylesheet" 
         href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Main CSS-->
        <link rel="stylesheet" href="style.css">
        <!-- Chat CSS-->
        <link rel="stylesheet" href="custom-chat.css">
        <!-- Leaflet CSS -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
        <!-- Leaflet JavaScript -->
        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
        <!-- GraphHopper JavaScript Client -->
        <script src="https://unpkg.com/graphhopper-js-api-client/dist/graphhopper-client.js"></script>
        <!-- Flatpickr Date Picker -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
        <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

        

        
    </head>
    <body class="bdy">
          

        <section class="index" id="index">
        <header class="header">
            <a href="home.html" class="logo" id="menu"><img src="LOGO.png" class="log"><span> WerTigo </span></a>
           
            <i class="fa-solid fa-bars" id="menu-icon"></i>
            <nav class="navbar">
               <a href="home.html" class="active"><span>Home </span></a>
               <a href="home.html#about"> <span>About us</span></a>
               <a href="#services"> <span>Services</span> </a>
               <a href="#contact"> <span>Contact</span></a>
               <a href="tracker.html"><span>Ticket Tracker</span></a>
            </nav>
        </header>

    </section>


    <!-- Right Side -->

    
    <div class="right-panel" id="right-panel">
        <div class="navigation">
            
            <div class="iti">
        
            
            <div id="map" style="height: 600px; width: 820px; margin-top: 20px; z-index: 1; border-radius: 12px; display: block; align-items: center; "></div>

        <script>
           
            var map = L.map('map').setView([14.5995, 120.9842], 13);
          
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
              attribution: 'Map data © OpenStreetMap contributors'
            }).addTo(map);
          
            // Global variables for route display
            var currentRouteLine = null;
            var currentRouteMarkers = [];
            
            // Function to clear existing route from the map
            function clearRoute() {
              // Remove existing route line if it exists
              if (currentRouteLine) {
                map.removeLayer(currentRouteLine);
                currentRouteLine = null;
              }
              
              // Remove existing markers
              currentRouteMarkers.forEach(marker => {
                map.removeLayer(marker);
              });
              currentRouteMarkers = [];
            }
            
            // Function to display route on the map
            function displayRouteOnMap(routeData, points) {
              // Clear any existing routes first
              clearRoute();
              
              // Add markers for each point
              points.forEach((point, index) => {
                const marker = L.marker([point.lat, point.lng])
                  .addTo(map)
                  .bindPopup(`<b>${point.name}</b><br>${index === 0 ? 'Starting Point' : `Stop ${index}`}`);
                currentRouteMarkers.push(marker);
                });
          
              // Add the route line
              const routePoints = routeData.points.map(coord => [coord[1], coord[0]]);
              currentRouteLine = L.polyline(routePoints, { 
                color: '#0066cc', 
                weight: 5,
                opacity: 0.7
              }).addTo(map);
              
              // Fit the map to show all markers and the route
              const bounds = L.latLngBounds(routePoints);
              map.fitBounds(bounds, { padding: [30, 30] });
              
              // Return the route summary for display
              return {
                distance_km: routeData.distance_km,
                time_min: routeData.time_min
              };
            }
          </script>
          <br>
            <div class="des">
            <img src="PICNIC.jpg" height="100px" width="100px" class="dest">
            <img src="SKY.jpg" height="100px" width="100px" class="dest">
            </div>
            <br>
            <br>
            <br>
            
            <p>Day 1</p>
            <p>------------------------------------</p>
            <br>
            <p>Picnic grove-----P50</p>
            <br>
            <p>Sky Ranch-------P300-P500</p>
            <br>
            <p>Total:    P550</p>
            </div>
            <!--
            <div class="right-links">
                <a href="#" class="link">For Partners</a>
                <span class="link">PHP</span>
                <button class="sign-up-btn">Sign up to save</button>
            </div>
        </div>
        
        <div class="right-panel-content">
            <h1 class="heading">YOUR TRAVEL AI GENIUS</h1>
            <p class="subheading">Got a vacation coming up? Start here by asking me anything about it.</p>
            
            <div class="slider-navigation">
                <span class="arrow-icon">◀</span>
                <div class="slider-dots">
                    <div class="dot"></div>
                    <div class="dot active"></div>
                    <div class="dot"></div>
                </div>
            </div>
        </div>
    </div>
</div>
-->

<!--Left Panel-->
        <div class="chat-button" id="chatButton">
            <i class="fas fa-comments"></i>
        </div>
    
        <div class="chat-container" id="chatContainer">
            <div class="chat-header" id="chatHeader">
                <div class="chat-header-info">
                    <div class="logo">WerTigo</div>
                    <div class="tagline">Now what is your plan?</div>
                </div>
                <!-- <div class="chat-header-actions">
                    <button class="header-button" id="minimizeButton">
                        <i class="fas fa-minus"></i>
                    </button>
                    <button class="header-button" id="closeButton">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                -->
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <div class="message bot">
                    <div class="message-avatar">
                    </div>
                    <div class="message-content">
                        Awesome! Let's get this travel party started! <br><br>
                        To whip up your perfect trip, I just need a few details:
                        <ol class="numbered-list">
                            <li>Destination: <span>Where are we heading?</span></li>
                            <li>Travel Dates: <span>When are you planning to go?</span></li>
                            <li>Number of Travelers: <span>How many people are joining the fun?</span></li>
                            <li>Budget: <span>Got a budget in mind?</span></li>
                            <li>Interests: <span>Any specific activities or experiences you want to include? (e.g., adventure, relaxation, culture, food, etc.)</span></li>
                        </ol>
                        
                    </div>
                </div>
            </div>
            
            <button class="create-trip-btn" id="createTripBtn">
                create a new trip
            </button>
            
            <div class="chat-input-container">
                <div class="chat-input">
                    <input type="text" id="userInput" placeholder="Ask anything, the more you share the better I can help..." />
                    <button class="send-button" id="sendButton">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div class="quick-replies">
                    <button class="quick-reply-btn" data-text="I have a destination">I have a destination</button>
                    <button class="quick-reply-btn" data-text="I need travel dates">I need travel dates</button>
                    <button class="quick-reply-btn" data-text="Tell me about activities">Tell me about activities</button>
                </div>
            </div>
        </div>
    
    

        <script>
              // DOM Elements
  const chatButton = document.getElementById('chatButton');
  const chatContainer = document.getElementById('chatContainer');
  const minimizeButton = document.getElementById('minimizeButton');
  const closeButton = document.getElementById('closeButton');
  const chatMessages = document.getElementById('chatMessages');
  const userInput = document.getElementById('userInput');
  const sendButton = document.getElementById('sendButton');
  const createTripBtn = document.getElementById('createTripBtn');
  const quickReplyBtns = document.querySelectorAll('.quick-reply-btn');

  // API endpoint for recommendations
  const API_URL = 'http://localhost:5000/api/recommend';
  
  // Simple session management (no user authentication)
  let authState = {
    sessionId: null
  };
  
  // Load session from localStorage on page load
  function loadAuthState() {
    const savedSession = localStorage.getItem('sessionState');
    if (savedSession) {
      try {
        const parsedSession = JSON.parse(savedSession);
        authState.sessionId = parsedSession.sessionId;
        console.log('Session loaded:', authState.sessionId);
      } catch (error) {
        console.error('Error parsing saved session:', error);
      }
    }
  }
  
  // Save session to localStorage
  function saveAuthState() {
    localStorage.setItem('sessionState', JSON.stringify(authState));
  }
  
  // Initialize session on page load
  async function initSession() {
    // Check if we already have a session ID
    if (authState.sessionId) {
      // Validate the existing session
      try {
        const response = await fetch(`http://localhost:5000/api/session/${authState.sessionId}`);
        if (response.ok) {
          console.log('Using existing session:', authState.sessionId);
          return;
        }
      } catch (error) {
        console.log('Existing session invalid, creating new one');
      }
    }
    
    try {
      const response = await fetch('http://localhost:5000/api/create_session', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        }
      });
      
      if (response.ok) {
        const data = await response.json();
        authState.sessionId = data.session_id;
        saveAuthState();
        console.log('Session created:', authState.sessionId);
      }
    } catch (error) {
      console.error('Error creating session:', error);
    }
  }
  
  // Call initSession on page load
  document.addEventListener('DOMContentLoaded', () => {
    loadAuthState();
    initSession();
  });

  // Add functions to handle sign up and sign in forms
  function handleSignUpForm() {
    const signUpForm = document.getElementById('signUpForm');
    
    if (signUpForm) {
      signUpForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const username = document.getElementById('signUpUsername').value.trim();
        const email = document.getElementById('signUpEmail').value.trim();
        const password = document.getElementById('signUpPassword').value.trim();
        
        const result = await register(username, email, password);
        
        if (result.success) {
          alert("Registration successful! You are now logged in.");
          window.location.href = "index.html"; // Redirect to main page
        } else {
          alert(`Registration failed: ${result.error}`);
        }
      });
    }
  }
  
  function handleSignInForm() {
    const signInForm = document.getElementById('signInForm');
    
    if (signInForm) {
      signInForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const email = document.getElementById('signInEmail').value.trim();
        const password = document.getElementById('signInPassword').value.trim();
        
        const result = await login(email, password);
        
        if (result.success) {
          alert("Login successful!");
          window.location.href = "index.html"; // Redirect to main page
        } else {
          alert(`Login failed: ${result.error}`);
        }
      });
    }
  }
  
  // Set up authentication forms when DOM is loaded
  document.addEventListener('DOMContentLoaded', function() {
    handleSignUpForm();
    handleSignInForm();
  });

  // Functions
  function toggleChat() {
      if (chatContainer.classList.contains('closed')) {
          chatContainer.style.display = 'flex';
          chatContainer.classList.remove('closed');
          chatButton.style.display = 'none';
      } else {
          chatContainer.style.display = 'none';
          chatContainer.classList.add('closed');
          chatButton.style.display = 'flex';
      }
  }

  function addMessage(content, isUser = false) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
      
      const avatarDiv = document.createElement('div');
      avatarDiv.className = 'message-avatar';
      
      if (isUser) {
          const iconElement = document.createElement('i');
          iconElement.className = 'fas fa-user';
          iconElement.style.color = 'white';
          iconElement.style.fontSize = '16px';
          avatarDiv.appendChild(iconElement);
      } else {
          const imgElement = document.createElement('img');
          imgElement.src = '';
          imgElement.alt = '';
          avatarDiv.appendChild(imgElement);
      }
      
      const contentDiv = document.createElement('div');
      contentDiv.className = 'message-content';
      contentDiv.innerHTML = content;
      
      messageDiv.appendChild(avatarDiv);
      messageDiv.appendChild(contentDiv);
      
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function showTypingIndicator() {
      const typingDiv = document.createElement('div');
      typingDiv.className = 'message bot';
      typingDiv.id = 'typingIndicator';
      
      const avatarDiv = document.createElement('div');
      avatarDiv.className = 'message-avatar';
      
      const imgElement = document.createElement('img');
      imgElement.src = '';
      imgElement.alt = '';
      avatarDiv.appendChild(imgElement);
      
      const contentDiv = document.createElement('div');
      contentDiv.className = 'message-content';
      contentDiv.innerHTML = '<div style="display: flex; gap: 4px; align-items: center; height: 20px;">' +
          '<div style="width: 8px; height: 8px; background-color: #999; border-radius: 50%; animation: typing-animation 1.4s infinite ease-in-out;"></div>' +
          '<div style="width: 8px; height: 8px; background-color: #999; border-radius: 50%; animation: typing-animation 1.4s infinite ease-in-out; animation-delay: 0.2s;"></div>' +
          '<div style="width: 8px; height: 8px; background-color: #999; border-radius: 50%; animation: typing-animation 1.4s infinite ease-in-out; animation-delay: 0.4s;"></div>' +
          '</div>';
      
      typingDiv.appendChild(avatarDiv);
      typingDiv.appendChild(contentDiv);
      
      chatMessages.appendChild(typingDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function removeTypingIndicator() {
      const typingIndicator = document.getElementById('typingIndicator');
      if (typingIndicator) {
          typingIndicator.remove();
      }
  }

  // Get recommendations from AI model with session support
  async function getRecommendations(query) {
    try {
      const requestBody = { 
        query,
        session_id: authState.sessionId 
      };
      
      console.log("Sending recommendation request:", requestBody);
      
      // Add a timeout to the fetch request
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), 20000); // 20 second timeout
      
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(requestBody),
          signal: controller.signal
        });
        
        clearTimeout(timeoutId); // Clear the timeout if fetch completes
  
        const data = await response.json();
        console.log("Received recommendation response:", data);
  
        if (!response.ok) {
          // Check if there's a conversation message in the error response
          if (data.is_conversation && data.message) {
            return {
              is_conversation: true,
              message: data.message
            };
          }
          
          throw new Error(data.error || 'Failed to get recommendations');
        }
  
        return data;
      } catch (fetchError) {
        clearTimeout(timeoutId); // Clear the timeout if fetch throws an error
        
        // Handle AbortController timeout
        if (fetchError.name === 'AbortError') {
          console.error('Request timed out');
          return {
            is_conversation: true,
            message: "I'm having trouble connecting to my brain right now. Please try again in a moment."
          };
        }
        
        // Re-throw the error to be handled by the outer catch
        throw fetchError;
      }
    } catch (error) {
      console.error('Error getting recommendations:', error);
      
      // Return a graceful conversational response
      return { 
        is_conversation: true, 
        message: "I'm having a little trouble processing that request right now. Could you try asking in a different way or try something simpler?" 
      };
    }
  }

  // Helper function to generate star rating HTML
  function getStarRating(rating) {
    // Convert rating to number between 1-5
    const numRating = typeof rating === 'number' ? rating : 4;
    const stars = Math.min(5, Math.max(1, Math.round(numRating)));
    
    // Generate star icons
    let starsHtml = '';
    for (let i = 0; i < 5; i++) {
        if (i < stars) {
            // Full star
            starsHtml += '★'; 
        } else {
            // Empty star
            starsHtml += '☆';
        }
    }
    
    return starsHtml;
  }

  // Format recommendations into HTML with enhanced understanding
  function formatRecommendations(recommendations, detectedCity, detectedCategory, queryUnderstanding, followUpSuggestions) {
    if (!recommendations || recommendations.length === 0) {
      return "I couldn't find any destinations matching your criteria. Can you try rephrasing your request?";
    }

    // Special handling for "plan dates" or romantic trip types
    const isDatePlanning = queryUnderstanding && 
      ((queryUnderstanding.detected_intent === 'plan_trip' && 
        queryUnderstanding.original_query && 
        queryUnderstanding.original_query.toLowerCase().includes('date')) || 
      (queryUnderstanding.trip_type === 'romantic'));

    if (isDatePlanning) {
      console.log("Handling romantic date planning query", queryUnderstanding);
      
      // Create a more specific and helpful response for date planning
      let dateContent = '<div class="recommendations">';
      dateContent += '<div class="query-understanding">';
      dateContent += '<span class="understanding-tag"><strong>Planning a Romantic Date</strong></span>';
      dateContent += '</div>';
      
      dateContent += '<p class="romantic-intro">I found some romantic places that would be perfect for dates:</p>';
      
      dateContent += '<div class="recommendation-list">';
      recommendations.forEach((rec, index) => {
        // Generate star rating HTML
        const rating = rec.rating || 4; // Default to 4 if rating is missing
        const starRating = getStarRating(rating);
        
        dateContent += `
          <div class="recommendation-item">
            <h3>${index + 1}. ${rec.name} (${rec.city})</h3>
            <div class="recommendation-details">
              <span class="category">${rec.category || 'Romantic Venue'}</span>
              <span class="rating">${starRating}</span>
            </div>
            <p class="description">${rec.description || 'A perfect spot for a romantic date.'}</p>
          </div>
        `;
      });
      dateContent += '</div>';
      
      dateContent += '<p class="romantic-suggestion">Would you like me to help you plan a complete romantic trip to one of these places?</p>';
      
      // Add quick reply buttons for this scenario
      dateContent += '<div class="follow-up-buttons">';
      if (recommendations[0]) {
        const firstDestination = recommendations[0].city;
        dateContent += `<button class="follow-up-btn" data-query="Plan a romantic trip to ${firstDestination}">Plan a romantic trip to ${firstDestination}</button>`;
      }
      dateContent += `<button class="follow-up-btn" data-query="Show me more romantic places">Show me more romantic places</button>`;
      dateContent += '</div>';
      
      dateContent += '</div>';
      
      return dateContent;
    }

    // Standard response for other types of queries
    let responseHTML = '<div class="recommendations">';
    
    // Add detected filters if available
    if (detectedCity || detectedCategory) {
      responseHTML += '<div class="detected-filters">';
      if (detectedCity) responseHTML += `<span>Location: <strong>${detectedCity}</strong></span>`;
      if (detectedCity && detectedCategory) responseHTML += ' | ';
      if (detectedCategory) responseHTML += `<span>Category: <strong>${detectedCategory}</strong></span>`;
      responseHTML += '</div>';
    }
    
    // Add understanding information if available
    if (queryUnderstanding) {
      const intent = queryUnderstanding.detected_intent;
      const tripType = queryUnderstanding.trip_type;
      const budget = queryUnderstanding.budget_preference;
      
      if (intent || tripType || budget) {
        responseHTML += '<div class="query-understanding">';
        if (intent) responseHTML += `<span class="understanding-tag">Looking for: <strong>${formatIntent(intent)}</strong></span>`;
        if (tripType) responseHTML += `<span class="understanding-tag">Trip type: <strong>${formatTripType(tripType)}</strong></span>`;
        if (budget) responseHTML += `<span class="understanding-tag">Budget: <strong>${formatBudget(budget)}</strong></span>`;
        responseHTML += '</div>';
      }
    }
    
    // Add each recommendation
    responseHTML += '<div class="recommendation-list">';
    recommendations.forEach((rec, index) => {
      // Generate star rating HTML
      const rating = rec.rating || 4; // Default to 4 if rating is missing
      const starRating = getStarRating(rating);
      
      responseHTML += `
        <div class="recommendation-item">
          <h3>${index + 1}. ${rec.name} (${rec.city})</h3>
          <div class="recommendation-details">
            <span class="category">${rec.category || 'Destination'}</span>
            <span class="rating">${starRating}</span>
          </div>
          <p class="description">${rec.description ? (rec.description.substring(0, 150) + (rec.description.length > 150 ? '...' : '')) : 'No description available.'}</p>
        </div>
      `;
    });
    responseHTML += '</div>';
    
    // Add follow-up suggestions if available
    if (followUpSuggestions && followUpSuggestions.length > 0) {
      responseHTML += '<div class="follow-up-suggestions">';
      responseHTML += '<p class="follow-up-title">You might want to ask:</p>';
      responseHTML += '<div class="follow-up-buttons">';
      
      followUpSuggestions.forEach(suggestion => {
        responseHTML += `<button class="follow-up-btn" data-query="${suggestion}">${suggestion}</button>`;
      });
      
      responseHTML += '</div></div>';
    }
    
    responseHTML += '</div>';
    
    return responseHTML;
  }

  // Helper functions for formatting understanding
  function formatIntent(intent) {
    const intentMap = {
      'find_destination': 'Destinations',
      'explore_activity': 'Activities',
      'plan_trip': 'Trip Planning',
      'get_info': 'Information'
    };
    return intentMap[intent] || intent;
  }

  function formatTripType(tripType) {
    const typeMap = {
      'adventure': 'Adventure',
      'relaxation': 'Relaxation',
      'cultural': 'Cultural',
      'family': 'Family',
      'romantic': 'Romantic'
    };
    return typeMap[tripType] || tripType;
  }

  function formatBudget(budget) {
    const budgetMap = {
      'low': 'Economic',
      'medium': 'Moderate',
      'high': 'Luxury'
    };
    return budgetMap[budget] || budget;
  }

  // Helper functions for budget handling in trip creation
  function parseBudgetAmount(budgetInput) {
      if (typeof budgetInput === 'number') return budgetInput;
      
      // Remove currency symbols, commas and spaces
      const cleanedInput = budgetInput.toString().replace(/[₱,\s]/g, '');
      
      // Try to extract a number
      const matches = cleanedInput.match(/(\d+)/);
      if (matches && matches[1]) {
          return parseInt(matches[1]);
      }
      
      return 0;
  }
  
  function formatTripBudget(amount) {
      // Format as Philippine Peso
      return `₱${amount.toLocaleString('en-PH')}`;
  }
  
  // Calculate per day budget for the confirmation message
  function calculatePerDayBudget(tripData) {
      if (!tripData.duration || tripData.duration <= 0) return '';
      
      // Extract just the number from the budget
      let budgetAmount = parseBudgetAmount(tripData.budget);
      
      // Calculate per day budget
      const perDayBudget = Math.floor(budgetAmount / tripData.duration);
      
      return ` (approx. ₱${perDayBudget.toLocaleString('en-PH')} per day)`;
  }

  async function sendMessage(message = null) {
      const userMessage = message || userInput.value.trim();
      if (userMessage === '') return;
      
      // Add user message
      addMessage(userMessage, true);
      userInput.value = '';
      
      // If we're in trip creation flow, process the answer
      if (tripCreationState.active) {
          if (tripCreationState.currentStep === -1) {
              // We're in confirmation state
              if (userMessage.toLowerCase() === 'yes') {
                  createTrip();
              } else if (userMessage.toLowerCase() === 'edit') {
                  // Restart the flow
                  startTripCreationFlow();
              } else {
                  addMessage("I didn't understand. Please type 'yes' to create the trip or 'edit' to make changes.", false);
              }
              return;
          } else if (tripCreationState.waitingFor === 'destination') {
              // We're waiting for the destination input
              const destination = userMessage.trim();
              
              // Show a loading message
              addMessage(`Looking up information about ${destination}...`, false);
              
              try {
                  // Search for this destination to see if it exists and get attractions
                  const response = await fetch(`http://localhost:5000/api/recommend`, {
                      method: 'POST',
                      headers: {
                          'Content-Type': 'application/json',
                      },
                      body: JSON.stringify({ 
                          query: `Show me attractions in ${destination}`,
                          session_id: authState.sessionId
                      })
                  });
                  
                  const data = await response.json();
                  
                  if (response.ok && data.recommendations && data.recommendations.length > 0) {
                      // Found attractions for this destination
                      const attractions = data.recommendations;
                      
                      // Display top attractions
                      let attractionsHtml = `
                          <div class="destination-attractions">
                              <h4>Top Attractions in ${destination}</h4>
                              <div class="attractions-list">
                      `;
                      
                      attractions.forEach(attraction => {
                          const starRating = getStarRating(attraction.rating || 4);
                          
                          attractionsHtml += `
                              <div class="attraction-item">
                                  <h5>${attraction.name}</h5>
                                  <div class="attraction-details">
                                      <span class="category">${attraction.category}</span>
                                      <span class="rating">${starRating}</span>
                                  </div>
                                  <p class="description">${attraction.description.substring(0, 120)}${attraction.description.length > 120 ? '...' : ''}</p>
                              </div>
                          `;
                      });
                      
                      attractionsHtml += `
                              </div>
                              <p>Would you like to visit ${destination}?</p>
                              <div class="destination-actions">
                                  <button id="confirm-destination-btn" class="confirm-btn">Yes, this looks perfect!</button>
                                  <button id="try-another-destination-btn" class="secondary-btn">Try another destination</button>
                              </div>
                          </div>
                      `;
                      
                      addMessage(attractionsHtml, false);
                      
                      // Add event listeners to buttons
                      setTimeout(() => {
                          document.getElementById('confirm-destination-btn').addEventListener('click', function() {
                              // Process the destination
                              tripCreationState.waitingFor = null; // Clear waiting flag
                              processTripAnswer(destination);
                          });
                          
                          document.getElementById('try-another-destination-btn').addEventListener('click', function() {
                              // Ask for destination again without advancing step
                              addMessage("Where else would you like to go?", false);
                          });
                      }, 100);
                  } else {
                      // No specific attractions found, ask for confirmation
                      const confirmationHtml = `
                          <div class="destination-confirmation">
                              <p>I don't have specific information about attractions in ${destination}, but we can still plan a trip there.</p>
                              <div class="destination-actions">
                                  <button id="confirm-unknown-destination-btn" class="confirm-btn">Continue with ${destination}</button>
                                  <button id="try-different-destination-btn" class="secondary-btn">Try a different destination</button>
                              </div>
                          </div>
                      `;
                      
                      addMessage(confirmationHtml, false);
                      
                      // Add event listeners to buttons
                      setTimeout(() => {
                          document.getElementById('confirm-unknown-destination-btn').addEventListener('click', function() {
                              // Process the destination
                              tripCreationState.waitingFor = null; // Clear waiting flag
                              processTripAnswer(destination);
                          });
                          
                          document.getElementById('try-different-destination-btn').addEventListener('click', function() {
                              // Ask for destination again without advancing step
                              addMessage("Where else would you like to go?", false);
                          });
                      }, 100);
                  }
              } catch (error) {
                  console.error('Error looking up destination:', error);
                  
                  // Fallback to simply accepting the destination
                  const fallbackHtml = `
                      <div class="destination-confirmation">
                          <p>I had trouble looking up information about ${destination}, but we can still plan your trip there.</p>
                          <div class="destination-actions">
                              <button id="confirm-fallback-destination-btn" class="confirm-btn">Continue with ${destination}</button>
                              <button id="retry-destination-btn" class="secondary-btn">Try again</button>
                          </div>
                      </div>
                  `;
                  
                  addMessage(fallbackHtml, false);
                  
                  // Add event listeners to buttons
                  setTimeout(() => {
                      document.getElementById('confirm-fallback-destination-btn').addEventListener('click', function() {
                          // Process the destination
                          tripCreationState.waitingFor = null; // Clear waiting flag
                          processTripAnswer(destination);
                      });
                      
                      document.getElementById('retry-destination-btn').addEventListener('click', function() {
                          // Ask for destination again without advancing step
                          addMessage("Where else would you like to go?", false);
                      });
                  }, 100);
              }
              
              return;
          } else if (tripCreationState.waitingFor === 'budget') {
              // We're waiting for the budget input
              const budget = userMessage.trim();
              
              // Validate the budget input
              const budgetAmount = parseBudgetAmount(budget);
              if (budgetAmount < 5000) {
                  addMessage("The minimum budget required is ₱5,000 per trip. Please enter a higher amount.", false);
                  return;
              }
              
              // Format and display the budget
              const formattedBudget = formatTripBudget(budgetAmount);
              addMessage(formattedBudget, true);
              
              // Process the budget answer
              tripCreationState.waitingFor = null;
              processTripAnswer(budgetAmount);
          } else {
              // Process the answer for the current step
              processTripAnswer(userMessage);
          }
          return;
      }
      
      // Regular message flow - show typing indicator
      showTypingIndicator();
      
      try {
          // Get recommendations
          const response = await getRecommendations(userMessage);
          
          // Remove typing indicator
          removeTypingIndicator();
          
          if (response.error && !response.is_conversation) {
              // Only show error if not a conversation response
              addMessage(`Sorry, I encountered an error: ${response.error}`);
              return;
          }
          
          if (response.is_conversation) {
              // Handle conversational response
              addMessage(response.message);
              return;
          }
          
          // Format and display recommendations
          const formattedResponse = formatRecommendations(
              response.recommendations, 
              response.detected_city, 
              response.detected_category,
              response.query_understanding,
              response.follow_up_suggestions
          );
          
          addMessage(formattedResponse);
          
          // Set up event listeners for follow-up buttons
      setTimeout(() => {
              document.querySelectorAll('.follow-up-btn').forEach(btn => {
                  btn.addEventListener('click', () => {
                      const query = btn.dataset.query;
                      if (query) {
                          sendMessage(query);
                      }
                  });
              });
          }, 100);
          
          // Update suggested quick replies based on context
          updateQuickReplies(response);
      } catch (error) {
          // Handle errors gracefully
          removeTypingIndicator();
          console.error('Error in sendMessage:', error);
          addMessage("Sorry, I'm having trouble connecting to my brain right now. Please try again in a moment.");
      }
  }
  
  // Update quick replies based on recent interactions
  function updateQuickReplies(result) {
    const quickRepliesContainer = document.querySelector('.quick-replies');
    if (!quickRepliesContainer) return;
    
    // Clear existing quick replies
    quickRepliesContainer.innerHTML = '';
    
    // If we have follow-up suggestions, use those first
    if (result.follow_up_suggestions && result.follow_up_suggestions.length > 0) {
      const suggestions = result.follow_up_suggestions.slice(0, 2); // Take at most 2
      
      suggestions.forEach(suggestion => {
        const btn = document.createElement('button');
        btn.className = 'quick-reply-btn';
        btn.textContent = suggestion;
        btn.dataset.text = suggestion;
        btn.addEventListener('click', () => {
          sendMessage(suggestion);
        });
        quickRepliesContainer.appendChild(btn);
      });
      
      // Add one more generic suggestion
      if (result.detected_city) {
        const btn = document.createElement('button');
        btn.className = 'quick-reply-btn';
        btn.textContent = `Things to do in ${result.detected_city}`;
        btn.dataset.text = `What are popular things to do in ${result.detected_city}?`;
        btn.addEventListener('click', () => {
          sendMessage(btn.dataset.text);
        });
        quickRepliesContainer.appendChild(btn);
      } else {
        const btn = document.createElement('button');
        btn.className = 'quick-reply-btn';
        btn.textContent = 'Create a trip';
        btn.dataset.text = 'I want to create a trip';
        btn.addEventListener('click', () => {
          sendMessage(btn.dataset.text);
        });
        quickRepliesContainer.appendChild(btn);
      }
      
      return;
    }
    
    // Generate contextual quick replies
    const newReplies = [];
    
    // If we have detected a city, suggest more specific queries about it
    if (result.detected_city) {
      newReplies.push({
        text: `Things to do in ${result.detected_city}`,
        query: `What can I do in ${result.detected_city}?`
      });
      
      // If we also detected a category, suggest more in the same city
      if (result.detected_category) {
        newReplies.push({
          text: `More ${result.detected_category} in ${result.detected_city}`,
          query: `Show me more ${result.detected_category} in ${result.detected_city}`
        });
      } else {
        // Suggest popular categories in this city
        const categories = ['historical sites', 'natural attractions', 'restaurants'];
        const randomCategory = categories[Math.floor(Math.random() * categories.length)];
        newReplies.push({
          text: `${randomCategory} in ${result.detected_city}`,
          query: `${randomCategory} in ${result.detected_city}`
        });
      }
    }
    
    // Add trip planning suggestion if we've been discussing destinations
    if (result.recommendations && result.recommendations.length > 0) {
      const destination = result.detected_city || result.recommendations[0].city;
      newReplies.push({
        text: `Plan a trip to ${destination}`,
        query: `I want to plan a trip to ${destination}`
      });
    }
    
    // Add some generic fallbacks if we don't have enough context-specific ones
    if (newReplies.length < 3) {
      if (!newReplies.some(r => r.text.includes('popular'))) {
        newReplies.push({
          text: 'Popular destinations',
          query: 'What are the most popular destinations?'
        });
      }
      
      if (!newReplies.some(r => r.text.includes('adventure'))) {
        newReplies.push({
          text: 'Adventure activities',
          query: 'Recommend adventure activities'
        });
      }
      
      if (!newReplies.some(r => r.text.includes('relaxing'))) {
        newReplies.push({
          text: 'Relaxing getaways',
          query: 'Suggest relaxing getaways'
        });
      }
    }
    
    // Take at most 3 replies
    const finalReplies = newReplies.slice(0, 3);
    
    // Add new quick replies
    finalReplies.forEach(reply => {
      const btn = document.createElement('button');
      btn.className = 'quick-reply-btn';
      btn.textContent = reply.text;
      btn.dataset.text = reply.query;
      btn.addEventListener('click', () => {
        sendMessage(reply.query);
      });
      quickRepliesContainer.appendChild(btn);
    });
  }

  function handleCreateTrip() {
      addMessage("I'd love to help you create a new trip! Let's start planning your journey.", false);
      
      // Start the trip creation flow
      startTripCreationFlow();
  }

  // Variables to store trip information
  let tripData = {
      destination: '',
      travel_dates: '',
      travelers: 1,
      budget: '',
      interests: []
  };
  
  // Trip creation flow state
  let tripCreationState = {
      active: false,
      currentStep: 0,
      steps: [
          { id: 'travel_dates', question: "When are you planning to travel? Please use the date picker below to select your travel dates." },
          { id: 'destination', question: "Great! Where would you like to go?" },
          { id: 'travelers', question: "How many people will be traveling?" },
          { id: 'budget', question: "What's your budget for this trip?" },
          { id: 'interests', question: "What are you interested in doing during this trip? (e.g., nature, history, food)" }
      ]
  };
  
  function startTripCreationFlow() {
      tripCreationState.active = true;
      tripCreationState.currentStep = 0;
      tripCreationState.waitingFor = null; // Initialize waiting state
      tripData = {
          destination: '',
          travel_dates: '',
          travelers: 1,
          budget: '',
          interests: []
      };
      
      // Ask the first question after a short delay
      setTimeout(() => {
          askTripQuestion(0);
      }, 1000);
  }
  
  function askTripQuestion(stepIndex) {
      if (stepIndex >= tripCreationState.steps.length) {
          // We've collected all the information, create the trip
          createTrip();
          return;
      }
      
      const step = tripCreationState.steps[stepIndex];
      
      // Special handling for date selection
      if (step.id === 'travel_dates') {
          // Create and insert a date picker UI
          const datepickerHtml = `
              <div class="date-picker-container">
                  <p>Please select your travel dates:</p>
                  <div class="date-input-container">
                      <input type="text" id="travel-date-picker" placeholder="Select date range" readonly>
                      <button id="date-confirm-btn" class="date-confirm-btn">Confirm Dates</button>
                  </div>
              </div>
          `;
          
          addMessage(datepickerHtml, false);
          
          // Initialize the date picker after it's added to the DOM
          setTimeout(() => {
              const dateInput = document.getElementById('travel-date-picker');
              if (dateInput) {
                  // Get today's date for min date
                  const today = new Date();
                  const minDate = today.toISOString().split('T')[0];
                  
                  // Initialize flatpickr
                  const fp = flatpickr(dateInput, {
                      mode: "range",
                      minDate: "today",
                      dateFormat: "Y-m-d",
                      altInput: true,
                      altFormat: "F j, Y",
                      showMonths: 2,
                      static: true
                  });
                  
                  // Add event listener to the confirm button
                  document.getElementById('date-confirm-btn').addEventListener('click', function() {
                      const selectedDates = dateInput.value;
                      if (selectedDates) {
                          // Process the date input directly
                          processTripAnswer(selectedDates);
                      } else {
                          addMessage("Please select a date range first.", false);
                      }
                  });
              }
          }, 100);
      } else if (step.id === 'destination') {
          // Special handling for destination input
          addMessage(step.question, false);
          
          // Don't create the input field anymore - user should type directly in chat
          // Set a flag to indicate we're waiting for destination
          tripCreationState.waitingFor = 'destination';
          
          // Add instructions to use chat with a visual hint
          addMessage(`
              <div class="chat-instruction">
                  <i class="fas fa-keyboard" style="margin-right: 8px;"></i>
                  Please type your destination in the chat box below (e.g., "Imus", "Boracay", "Manila").
                  <div class="instruction-arrow">
                      <i class="fas fa-arrow-down" style="animation: bounce 1.5s infinite;"></i>
                  </div>
              </div>
          `, false);
          
          // Add a bit of CSS for the animation
          const arrowStyle = document.createElement('style');
          arrowStyle.innerHTML = `
              @keyframes bounce {
                  0%, 100% { transform: translateY(0); }
                  50% { transform: translateY(10px); }
              }
              .chat-instruction {
                  background: rgba(0, 229, 255, 0.1);
                  border-left: 3px solid #00e5ff;
                  padding: 12px;
                  margin-top: 8px;
                  border-radius: 4px;
              }
              .instruction-arrow {
                  text-align: center;
                  margin-top: 12px;
                  color: #00e5ff;
                  font-size: 20px;
              }
          `;
          document.head.appendChild(arrowStyle);
      } else if (step.id === 'budget') {
          // Special handling for budget input
          addMessage(step.question, false);
          
          // Set a flag to indicate we're waiting for budget
          tripCreationState.waitingFor = 'budget';
          
          // Create a budget selection UI with slider and preset options
          const budgetHtml = `
              <div class="budget-selector-container">
                  <p class="budget-note">Please enter your budget (minimum ₱5,000):</p>
                  
                  <div class="budget-input-container">
                      <span class="currency-symbol">₱</span>
                      <input type="number" id="budget-input" min="5000" value="10000" class="budget-input">
                      <button id="budget-confirm-btn" class="budget-confirm-btn">Confirm Budget</button>
                  </div>
                  
                  <div class="budget-slider-container">
                      <input type="range" id="budget-slider" min="5000" max="100000" step="1000" value="10000" class="budget-slider">
                      <div class="budget-range-labels">
                          <span>₱5,000</span>
                          <span>₱50,000</span>
                          <span>₱100,000</span>
                      </div>
                  </div>
                  
                  <div class="budget-presets">
                      <button class="budget-preset-btn" data-value="5000">Basic (₱5,000)</button>
                      <button class="budget-preset-btn" data-value="15000">Standard (₱15,000)</button>
                      <button class="budget-preset-btn" data-value="30000">Premium (₱30,000)</button>
                      <button class="budget-preset-btn" data-value="50000">Luxury (₱50,000)</button>
                  </div>
                  
                  <p class="trip-duration-note">Your trip will be <span id="trip-days">${tripData.duration || 'several'}</span> days long. The budget should be sufficient for the entire duration.</p>
              </div>
          `;
          
          addMessage(budgetHtml, false);
          
          // Initialize budget controls
          setTimeout(() => {
              const budgetInput = document.getElementById('budget-input');
              const budgetSlider = document.getElementById('budget-slider');
              const budgetConfirmBtn = document.getElementById('budget-confirm-btn');
              const presetButtons = document.querySelectorAll('.budget-preset-btn');
              
              if (budgetInput && budgetSlider && budgetConfirmBtn) {
                  // Sync slider and input
                  budgetInput.addEventListener('input', function() {
                      const value = parseInt(this.value) || 5000;
                      if (value < 5000) {
                          this.value = 5000;
                      }
                      budgetSlider.value = this.value;
                  });
                  
                  budgetSlider.addEventListener('input', function() {
                      budgetInput.value = this.value;
                  });
                  
                  // Add preset button functionality
                  presetButtons.forEach(button => {
                      button.addEventListener('click', function() {
                          const value = parseInt(this.dataset.value);
                          budgetInput.value = value;
                          budgetSlider.value = value;
                      });
                  });
                  
                  // Confirm button
                  budgetConfirmBtn.addEventListener('click', function() {
                      const value = parseInt(budgetInput.value) || 0;
                      if (value < 5000) {
                          addMessage("The minimum budget required is ₱5,000 per trip. Please enter a higher amount.", false);
                          return;
                      }
                      
                      // Format and display the budget
                      const formattedBudget = formatTripBudget(value);
                      addMessage(formattedBudget, true);
                      
                      // Process the budget answer
                      tripCreationState.waitingFor = null;
                      processTripAnswer(value);
                  });
              }
          }, 100);
      } else if (step.id === 'interests') {
          // Special handling for interests - fetch categories and display as selectable options
          addMessage(step.question, false);
          
          // Create a container for the categories
          const categoriesHtml = `
              <div class="categories-container">
                  <p>Loading available categories...</p>
                  <div id="categories-list" class="categories-list"></div>
                  <div class="categories-actions">
                      <button id="confirm-categories-btn" class="confirm-categories-btn">Confirm Selections</button>
                  </div>
              </div>
          `;
          
          addMessage(categoriesHtml, false);
          
          // Fetch categories from API
          fetchCategories();
      } else {
          // Regular questions
          addMessage(step.question, false);
      }
  }
  
  // Function to fetch categories from API
  async function fetchCategories() {
      try {
          const response = await fetch('http://localhost:5000/api/categories');
          const data = await response.json();
          
          if (response.ok && data.categories) {
              displayCategories(data.categories);
          } else {
              // Error handling for the categories
              document.getElementById('categories-list').innerHTML = `
                  <p class="error-text">Sorry, couldn't load categories. Please type your interests separated by commas.</p>
                  <input type="text" id="interests-input" class="interests-input" placeholder="e.g., nature, history, food">
                  <button id="interests-confirm-btn" class="confirm-categories-btn">Confirm</button>
              `;
              
              // Add event listener to the confirm button
              document.getElementById('interests-confirm-btn').addEventListener('click', function() {
                  const interestsInput = document.getElementById('interests-input');
                  if (interestsInput && interestsInput.value.trim()) {
                      processTripAnswer(interestsInput.value);
                  } else {
                      addMessage("Please enter at least one interest.", false);
                  }
              });
          }
      } catch (error) {
          console.error('Error fetching categories:', error);
          // Fallback to text input
          document.getElementById('categories-list').innerHTML = `
              <p class="error-text">Sorry, couldn't load categories. Please type your interests separated by commas.</p>
              <input type="text" id="interests-input" class="interests-input" placeholder="e.g., nature, history, food">
              <button id="interests-confirm-btn" class="confirm-categories-btn">Confirm</button>
          `;
          
          // Add event listener to the confirm button
          document.getElementById('interests-confirm-btn').addEventListener('click', function() {
              const interestsInput = document.getElementById('interests-input');
              if (interestsInput && interestsInput.value.trim()) {
                  processTripAnswer(interestsInput.value);
              } else {
                  addMessage("Please enter at least one interest.", false);
              }
          });
      }
  }

  // Function to display categories as selectable options
  function displayCategories(categories) {
      const categoriesList = document.getElementById('categories-list');
      if (!categoriesList) return;
      
      // Clear loading message
      categoriesList.innerHTML = '';
      
      // Add each category as a checkbox
      categories.forEach(category => {
          const categoryItem = document.createElement('div');
          categoryItem.className = 'category-item';
          
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.id = `category-${category.replace(/\s+/g, '-').toLowerCase()}`;
          checkbox.value = category;
          checkbox.className = 'category-checkbox';
          
          const label = document.createElement('label');
          label.htmlFor = checkbox.id;
          label.textContent = category;
          
          categoryItem.appendChild(checkbox);
          categoryItem.appendChild(label);
          categoriesList.appendChild(categoryItem);
      });
      
      // Add "Other" option with text input
      const otherItem = document.createElement('div');
      otherItem.className = 'category-item other-category';
      
      const otherCheckbox = document.createElement('input');
      otherCheckbox.type = 'checkbox';
      otherCheckbox.id = 'category-other';
      otherCheckbox.className = 'category-checkbox';
      
      const otherLabel = document.createElement('label');
      otherLabel.htmlFor = 'category-other';
      otherLabel.textContent = 'Other:';
      
      const otherInput = document.createElement('input');
      otherInput.type = 'text';
      otherInput.id = 'other-interests';
      otherInput.className = 'other-interests-input';
      otherInput.placeholder = 'Type other interests...';
      otherInput.disabled = true;
      
      // Enable/disable the other input based on checkbox state
      otherCheckbox.addEventListener('change', function() {
          otherInput.disabled = !this.checked;
          if (this.checked) {
              otherInput.focus();
          }
      });
      
      otherItem.appendChild(otherCheckbox);
      otherItem.appendChild(otherLabel);
      otherItem.appendChild(otherInput);
      categoriesList.appendChild(otherItem);
      
      // Add event listener to the confirm button
      document.getElementById('confirm-categories-btn').addEventListener('click', function() {
          const selectedCategories = [];
          
          // Get all checked categories
          document.querySelectorAll('.category-checkbox:checked').forEach(checkbox => {
              if (checkbox.id === 'category-other') {
                  const otherValue = document.getElementById('other-interests').value.trim();
                  if (otherValue) {
                      // Split other interests by commas
                      const otherInterests = otherValue.split(',').map(i => i.trim());
                      selectedCategories.push(...otherInterests);
                  }
              } else {
                  selectedCategories.push(checkbox.value);
              }
          });
          
          if (selectedCategories.length > 0) {
              // Add user's selection as a message
              addMessage(selectedCategories.join(', '), true);
              processTripAnswer(selectedCategories.join(', '));
          } else {
              addMessage("Please select at least one interest or enter your own.", false);
          }
      });
  }

  function processTripAnswer(answer) {
      const currentStep = tripCreationState.steps[tripCreationState.currentStep];
      
      // Process the answer based on the current step
      switch (currentStep.id) {
          case 'destination':
              tripData.destination = answer;
              break;
          case 'travel_dates':
              tripData.travel_dates = answer;
              // Calculate and store trip duration
              try {
                  const datesParts = answer.split(' to ');
                  if (datesParts.length === 2) {
                      const startDate = new Date(datesParts[0]);
                      const endDate = new Date(datesParts[1]);
                      const diffTime = Math.abs(endDate - startDate);
                      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; // Include both start and end day
                      tripData.duration = diffDays;
                  } else {
                      tripData.duration = 0; // Default if date format is incorrect
                  }
              } catch (e) {
                  console.error('Error calculating trip duration:', e);
                  tripData.duration = 0;
              }
              break;
          case 'travelers':
              tripData.travelers = parseInt(answer) || 1;
              break;
          case 'budget':
              // Validate minimum budget requirement (5000+)
              const budgetAmount = parseBudgetAmount(answer);
              if (budgetAmount < 5000) {
                  addMessage(`The minimum budget required is ₱5,000 per trip. Please enter a higher amount.`, false);
                  // Don't advance to next step, stay on budget question
                  return;
              }
              tripData.budget = formatTripBudget(budgetAmount);
              break;
          case 'interests':
              tripData.interests = answer.split(',').map(i => i.trim());
              break;
      }
      
      // Move to the next step
      tripCreationState.currentStep++;
      
      // If we have more steps, ask the next question
      if (tripCreationState.currentStep < tripCreationState.steps.length) {
          setTimeout(() => {
              askTripQuestion(tripCreationState.currentStep);
          }, 1000);
      } else {
          // We've collected all data, confirm with the user
          const confirmationMessage = `
              <div class="trip-confirmation">
                  <h3>Trip Summary</h3>
                  <ul>
                      <li><strong>Destination:</strong> ${tripData.destination}</li>
                      <li><strong>Dates:</strong> ${tripData.travel_dates}</li>
                      <li><strong>Duration:</strong> ${tripData.duration} days</li>
                      <li><strong>Travelers:</strong> ${tripData.travelers}</li>
                      <li><strong>Budget:</strong> ${tripData.budget}${calculatePerDayBudget(tripData)}</li>
                      <li><strong>Interests:</strong> ${tripData.interests.join(', ')}</li>
                  </ul>
                  <p>Would you like to create this trip? Type "yes" to continue or "edit" to make changes.</p>
              </div>
          `;
          addMessage(confirmationMessage, false);
          tripCreationState.currentStep = -1; // Special state for confirmation
      }
  }
  
  async function createTrip() {
      // Show loading message
      addMessage("Creating your trip...", false);
      showTypingIndicator();
      
      try {
          // Call the API to create the trip
          const response = await fetch(`http://localhost:5000/api/create_trip?session_id=${authState.sessionId}`, {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
              },
              body: JSON.stringify(tripData),
          });
          
          const result = await response.json();
          removeTypingIndicator();
          
          if (response.ok) {
              // Display the created trip itinerary
              displayTripItinerary(result.trip);
              tripCreationState.active = false;
          } else {
              // Handle errors
              if (result.error === 'Destination not found' && result.suggestions) {
                  const suggestionsHtml = result.suggestions.map(city => 
                      `<button class="suggestion-btn" data-city="${city}">${city}</button>`
                  ).join('');
                  
                  addMessage(`
                      <div class="error-message">
                          <p>I couldn't find "${tripData.destination}" in my database. Did you mean one of these?</p>
                          <div class="city-suggestions">${suggestionsHtml}</div>
                          <p>Or you can type a different destination.</p>
                      </div>
                  `, false);
                  
                  // Add event listeners to suggestion buttons
                  setTimeout(() => {
                      document.querySelectorAll('.suggestion-btn').forEach(btn => {
                          btn.addEventListener('click', () => {
                              const city = btn.dataset.city;
                              tripData.destination = city;
                              addMessage(city, true);
                              createTrip();
                          });
                      });
                  }, 100);
                  
                  // Go back to destination step
                  tripCreationState.currentStep = 0;
              } else {
                  addMessage(`Sorry, I encountered an error: ${result.error}`, false);
              }
          }
      } catch (error) {
          removeTypingIndicator();
          addMessage("Sorry, there was a problem creating your trip. Please try again later.", false);
          console.error('Error creating trip:', error);
      }
  }
  
  function displayTripItinerary(trip) {
      let itineraryHtml = `
          <div class="trip-itinerary">
              <h3>Your Trip to ${trip.destination}</h3>
              <p><strong>Dates:</strong> ${trip.travel_dates}</p>
              <p><strong>Travelers:</strong> ${trip.travelers}</p>
              
              <div class="itinerary-days">
      `;
      
      if (trip.itinerary && trip.itinerary.length > 0) {
          trip.itinerary.forEach(day => {
              itineraryHtml += `
                  <div class="itinerary-day">
                      <h4>Day ${day.day}</h4>
                      <div class="day-places">
              `;
              
              day.places.forEach(place => {
                  // Generate star rating HTML
                  const starRating = getStarRating(place.rating);
                  
                  itineraryHtml += `
                      <div class="day-place">
                          <h5>${place.name}</h5>
                          <div class="place-details">
                              <span class="category">${place.category}</span>
                              <span class="rating">${starRating}</span>
                          </div>
                          <p class="description">${place.description.substring(0, 100)}${place.description.length > 100 ? '...' : ''}</p>
                      </div>
                  `;
              });
              
              itineraryHtml += `
                      </div>
                      <div class="day-meals">
                          <h5>Meals</h5>
                          <ul>
              `;
              
              day.meals.forEach(meal => {
                  itineraryHtml += `<li><strong>${meal.type}:</strong> ${meal.suggestion}</li>`;
              });
              
              itineraryHtml += `
                          </ul>
                      </div>
                      <div class="day-transport">
                          <h5>Transportation</h5>
                          <p>${day.transportation}</p>
                      </div>
                      <div class="day-cost">
                          <h5>Estimated Cost</h5>
                          <p>${day.estimated_cost}</p>
                      </div>
                      <button class="view-route-btn" data-day="${day.day}">View Route on Map</button>
                      <div class="route-info" id="route-info-day-${day.day}" style="display: none;"></div>
                  </div>
              `;
          });
      } else {
          itineraryHtml += `<p>No itinerary available for this trip.</p>`;
      }
      
      // Add ticket creation functionality with email input
      itineraryHtml += `
              </div>
              <div class="ticket-creation">
                  <h4>Create a Tracking Ticket</h4>
                  <p>Enter your email to create a ticket for tracking this itinerary:</p>
                  <div class="ticket-input-container">
                      <input type="email" id="ticketEmail" placeholder="your@email.com" required />
                      <button class="create-ticket-btn" id="createTicketBtn">Create Ticket</button>
                  </div>
                  <div id="ticketResult" class="ticket-result" style="display: none;"></div>
              </div>
              <button class="save-trip-btn" id="saveTripBtn">Save Trip</button>
          </div>
      `;
      
      addMessage(itineraryHtml, false);
      
      // Add event listeners to view route buttons and save trip button
      setTimeout(() => {
          // Add event listeners to route buttons
          document.querySelectorAll('.view-route-btn').forEach(btn => {
              btn.addEventListener('click', async () => {
                  const dayIndex = parseInt(btn.dataset.day) - 1;
                  if (dayIndex >= 0 && dayIndex < trip.itinerary.length) {
                      const day = trip.itinerary[dayIndex];
                      
                      try {
                          // Update the button text to show loading
                          btn.textContent = "Loading route...";
                          btn.disabled = true;
                          
                          // Get the route for this day's places
                          const response = await fetch('http://localhost:5000/api/route_for_itinerary', {
                              method: 'POST',
                              headers: {
                                  'Content-Type': 'application/json',
                              },
                              body: JSON.stringify({
                                  day: day,
                                  // Use Manila coordinates as starting point if needed
                                  startingPoint: { lat: 14.5995, lng: 120.9842, name: "Starting Point" }
                              }),
                          });
                          
                          if (response.ok) {
                              const routeData = await response.json();
                              
                              // Display the route on the main map
                              const routeSummary = displayRouteOnMap(routeData.route, routeData.points);
                              
                              // Display route information in the itinerary
                              const routeInfoElement = document.getElementById(`route-info-day-${day.day}`);
                              if (routeInfoElement) {
                                  routeInfoElement.style.display = 'block';
                                  routeInfoElement.innerHTML = `
                                      <div class="route-summary">
                                          <p><i class="fas fa-route"></i> <strong>Total Distance:</strong> ${routeData.total_distance_km} km</p>
                                          <p><i class="fas fa-clock"></i> <strong>Estimated Travel Time:</strong> ${routeData.total_time_min} minutes</p>
                                      </div>
                                  `;
                              }
                              
                              // Reset the button text
                              btn.textContent = "View Route on Map";
                              btn.disabled = false;
                              
                              // Scroll the page to show the map
                              document.getElementById('map').scrollIntoView({ behavior: 'smooth' });
                          } else {
                              const errorData = await response.json();
                              console.error('Error getting route:', errorData.error);
                              
                              // Show error in route info
                              const routeInfoElement = document.getElementById(`route-info-day-${day.day}`);
                              if (routeInfoElement) {
                                  routeInfoElement.style.display = 'block';
                                  routeInfoElement.innerHTML = `
                                      <div class="route-error">
                                          <p><i class="fas fa-exclamation-triangle"></i> <strong>Error:</strong> ${errorData.error}</p>
                                      </div>
                                  `;
                              }
                              
                              // Reset the button text
                              btn.textContent = "View Route on Map";
                              btn.disabled = false;
                          }
                      } catch (error) {
                          console.error('Error fetching route:', error);
                          
                          // Show error in route info
                          const routeInfoElement = document.getElementById(`route-info-day-${day.day}`);
                          if (routeInfoElement) {
                              routeInfoElement.style.display = 'block';
                              routeInfoElement.innerHTML = `
                                  <div class="route-error">
                                      <p><i class="fas fa-exclamation-triangle"></i> <strong>Error:</strong> Could not load route. Please try again later.</p>
                                  </div>
                              `;
                          }
                          
                          // Reset the button text
                          btn.textContent = "View Route on Map";
                          btn.disabled = false;
                      }
                  }
              });
          });
          
          // Add event listener to create ticket button
          const createTicketBtn = document.getElementById('createTicketBtn');
          if (createTicketBtn) {
              createTicketBtn.addEventListener('click', async () => {
                  const emailInput = document.getElementById('ticketEmail');
                  const ticketResult = document.getElementById('ticketResult');
                  
                  if (!emailInput || !ticketResult) return;
                  
                  const email = emailInput.value.trim();
                  if (!email || !email.includes('@')) {
                      ticketResult.style.display = 'block';
                      ticketResult.innerHTML = '<p class="error">Please enter a valid email address</p>';
                      return;
                  }
                  
                  // Disable button and show loading
                  createTicketBtn.disabled = true;
                  createTicketBtn.textContent = 'Creating...';
                  ticketResult.style.display = 'block';
                  ticketResult.innerHTML = '<p>Creating ticket...</p>';
                  
                  try {
                      // Create a ticket for this trip
                      const response = await fetch('http://localhost:5000/api/create_ticket', {
                          method: 'POST',
                          headers: {
                              'Content-Type': 'application/json',
                          },
                          body: JSON.stringify({
                              email: email,
                              itinerary: trip
                          }),
                      });
                      
                      const data = await response.json();
                      
                      if (response.ok) {
                          // Show success message with the ticket ID
                          ticketResult.innerHTML = `
                              <div class="ticket-success">
                                  <p><i class="fas fa-check-circle"></i> Ticket created successfully!</p>
                                  <p><strong>Ticket ID:</strong> ${data.ticket_id}</p>
                                  <p>You can use this ticket ID and your email to track your itinerary on our tracking page.</p>
                                  <a href="tracker.html" class="ticket-link">Go to Tracking Page</a>
                              </div>
                          `;
                          
                          // Save the ticket ID locally
                          localStorage.setItem('lastTicketId', data.ticket_id);
                          localStorage.setItem('lastTicketEmail', email);
                      } else {
                          // Show error message
                          ticketResult.innerHTML = `
                              <div class="ticket-error">
                                  <p><i class="fas fa-exclamation-circle"></i> Error: ${data.error || 'Could not create ticket'}</p>
                              </div>
                          `;
                      }
                  } catch (error) {
                      console.error('Error creating ticket:', error);
                      ticketResult.innerHTML = `
                          <div class="ticket-error">
                              <p><i class="fas fa-exclamation-circle"></i> Error: Could not create ticket. Please try again later.</p>
                          </div>
                      `;
                  } finally {
                      // Re-enable button
                      createTicketBtn.disabled = false;
                      createTicketBtn.textContent = 'Create Ticket';
                  }
              });
          }
          
          // Add event listener to save trip button
          const saveTripBtn = document.getElementById('saveTripBtn');
          if (saveTripBtn) {
              saveTripBtn.addEventListener('click', () => {
                  // Save trip to local storage
                  try {
                      // Get existing saved trips or initialize empty array
                      const savedTrips = JSON.parse(localStorage.getItem('savedTrips') || '[]');
                      
                      // Add current trip with timestamp
                      const tripToSave = {
                          ...trip,
                          saved_at: new Date().toISOString()
                      };
                      
                      // Add to saved trips
                      savedTrips.push(tripToSave);
                      
                      // Save back to local storage
                      localStorage.setItem('savedTrips', JSON.stringify(savedTrips));
                      
                      // Show success message
                      addMessage("Trip saved successfully! You can find it in your browser's local storage.", false);
                  } catch (error) {
                      console.error('Error saving trip:', error);
                      addMessage("Sorry, there was a problem saving your trip.", false);
                  }
              });
          }
      }, 100);
  }

  // Event Listeners
  chatButton.addEventListener('click', toggleChat);
  if (closeButton) {
  closeButton.addEventListener('click', toggleChat);
  }
  
  sendButton.addEventListener('click', () => sendMessage());
  userInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
          sendMessage();
      }
  });
  
  createTripBtn.addEventListener('click', handleCreateTrip);
  
  quickReplyBtns.forEach(btn => {
      btn.addEventListener('click', () => {
          sendMessage(btn.dataset.text);
      });
  });

  // Add CSS animation for typing indicator
  const style = document.createElement('style');
  style.innerHTML = `
      @keyframes typing-animation {
          0% { transform: scale(1); }
          50% { transform: scale(1.5); }
          100% { transform: scale(1); }
      }
  `;
  document.head.appendChild(style);


  document.addEventListener('DOMContentLoaded', function() {
    // Slider functionality
    const dots = document.querySelectorAll('.dot');
    const arrowIcon = document.querySelector('.arrow-icon');
    let currentSlide = 1; // Since the second dot is active initially
    
    // Function to update active dot
    function updateActiveDot(index) {
        dots.forEach((dot, i) => {
            if (i === index) {
                dot.classList.add('active');
            } else {
                dot.classList.remove('active');
            }
        });
    }
    
    // Event listeners for dots
    if (dots.length > 0) {
    dots.forEach((dot, index) => {
        dot.addEventListener('click', function() {
            currentSlide = index;
            updateActiveDot(currentSlide);
        });
    });
    }
    
    // Arrow navigation
    if (arrowIcon) {
    arrowIcon.addEventListener('click', function() {
        currentSlide = (currentSlide - 1 + dots.length) % dots.length; // Go backwards
        updateActiveDot(currentSlide);
    });
    }
    
    // Sign up button functionality
    const signUpBtn = document.querySelector('.sign-up-btn');
    if (signUpBtn) {
    signUpBtn.addEventListener('click', function() {
        // Replace with your sign up functionality
        alert('Sign up functionality goes here!');
    });
    }
    
    // Welcome message
    setTimeout(() => {
      addMessage("Hi there! I'm your travel AI assistant. I can help you find destinations based on your interests. Just tell me what kind of places you're looking for!");
    }, 1000);
});

document.addEventListener("DOMContentLoaded", function() {
    // Get reference to chat container
    const chatContainer = document.getElementById("chatContainer");
    
    if (chatContainer) {
    // Apply animation styles programmatically
    chatContainer.style.transform = "translateX(-100%)";
    chatContainer.style.animation = "slideInFromLeft 0.8s ease-out forwards";
    
    // Add the keyframes for the animation if they don't exist in your CSS already
    if (!document.getElementById("chat-animation-keyframes")) {
        const styleSheet = document.createElement("style");
        styleSheet.id = "chat-animation-keyframes";
        styleSheet.textContent = `
            @keyframes slideInFromLeft {
                0% {
                    transform: translateX(-100%);
                    opacity: 0;
                }
                100% {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(styleSheet);
      }
    }
});

// Add CSS for the date picker at the end of the file before the closing </script> tag

const datepickerStyles = document.createElement('style');
datepickerStyles.textContent = `
    .date-picker-container {
        margin-top: 10px;
        margin-bottom: 15px;
    }
    
    .date-input-container {
        display: flex;
        margin-top: 10px;
        gap: 8px;
    }
    
    #travel-date-picker {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid #ccc;
        border-radius: 4px;
        background-color: rgba(255, 255, 255, 0.9);
        color: #333;
        font-size: 14px;
        cursor: pointer;
    }
    
    .date-confirm-btn {
        padding: 8px 16px;
        background: linear-gradient(45deg, #00e5ff, #b400ff);
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .date-confirm-btn:hover {
        opacity: 0.9;
        transform: translateY(-2px);
    }
    
    /* Destination input styles */
    .destination-input-container {
        display: flex;
        margin-top: 10px;
        gap: 8px;
        margin-bottom: 15px;
    }
    
    .destination-input {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid #ccc;
        border-radius: 4px;
        background-color: rgba(255, 255, 255, 0.9);
        color: #333;
        font-size: 14px;
    }
    
    .destination-confirm-btn {
        padding: 8px 16px;
        background: linear-gradient(45deg, #00e5ff, #b400ff);
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .destination-confirm-btn:hover {
        opacity: 0.9;
        transform: translateY(-2px);
    }
    
    /* Destination attractions styles */
    .destination-attractions {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 15px;
        margin-top: 15px;
        margin-bottom: 15px;
    }
    
    .destination-attractions h4 {
        margin-top: 0;
        margin-bottom: 12px;
        color: white;
        font-size: 16px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        padding-bottom: 8px;
    }
    
    .attractions-list {
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
        max-height: 300px;
        overflow-y: auto;
        margin-bottom: 15px;
        padding-right: 5px;
    }
    
    .attraction-item {
        background: rgba(255, 255, 255, 0.15);
        border-radius: 6px;
        padding: 12px;
        transition: all 0.2s ease;
    }
    
    .attraction-item:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateY(-2px);
    }
    
    .attraction-item h5 {
        margin-top: 0;
        margin-bottom: 6px;
        font-size: 15px;
        color: white;
    }
    
    .attraction-details {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 12px;
    }
    
    .attraction-details .category {
        background: rgba(0, 229, 255, 0.2);
        padding: 2px 8px;
        border-radius: 12px;
    }
    
    .attraction-details .rating {
        color: #ffde59;
    }
    
    .attraction-item .description {
        margin: 0;
        font-size: 13px;
        line-height: 1.4;
        color: rgba(255, 255, 255, 0.8);
    }
    
    /* Destination actions styles */
    .destination-actions {
        display: flex;
        gap: 10px;
        margin-top: 12px;
    }
    
    .confirm-btn {
        padding: 8px 16px;
        background: linear-gradient(45deg, #00e5ff, #b400ff);
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 600;
        flex: 1;
        transition: all 0.3s ease;
    }
    
    .confirm-btn:hover {
        opacity: 0.9;
        transform: translateY(-2px);
    }
    
    .secondary-btn {
        padding: 8px 16px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 4px;
        cursor: pointer;
        font-weight: 600;
        flex: 1;
        transition: all 0.3s ease;
    }
    
    .secondary-btn:hover {
        background: rgba(255, 255, 255, 0.2);
    }
    
    /* Destination confirmation styles */
    .destination-confirmation {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 15px;
        margin-top: 15px;
        margin-bottom: 15px;
    }
    
    /* Flatpickr custom styles */
    .flatpickr-calendar {
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 6px 24px rgba(0,0,0,0.15);
        margin-top: 5px;
    }
    
    .flatpickr-day.selected, 
    .flatpickr-day.startRange, 
    .flatpickr-day.endRange, 
    .flatpickr-day.selected.inRange, 
    .flatpickr-day.startRange.inRange, 
    .flatpickr-day.endRange.inRange, 
    .flatpickr-day.selected:focus, 
    .flatpickr-day.startRange:focus, 
    .flatpickr-day.endRange:focus, 
    .flatpickr-day.selected:hover, 
    .flatpickr-day.startRange:hover, 
    .flatpickr-day.endRange:hover, 
    .flatpickr-day.selected.prevMonthDay, 
    .flatpickr-day.startRange.prevMonthDay, 
    .flatpickr-day.endRange.prevMonthDay, 
    .flatpickr-day.selected.nextMonthDay, 
    .flatpickr-day.startRange.nextMonthDay, 
    .flatpickr-day.endRange.nextMonthDay {
        background: linear-gradient(45deg, #00e5ff, #b400ff);
        border-color: transparent;
    }
    
    .flatpickr-day.inRange, 
    .flatpickr-day.prevMonthDay.inRange, 
    .flatpickr-day.nextMonthDay.inRange {
        background-color: rgba(0, 229, 255, 0.2);
        border-color: transparent;
    }
    
    /* Category selection styles */
    .categories-container {
        margin-top: 10px;
        margin-bottom: 15px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 15px;
        max-height: 300px;
        overflow-y: auto;
    }
    
    .categories-list {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin-top: 10px;
        margin-bottom: 15px;
    }
    
    @media (max-width: 600px) {
        .categories-list {
            grid-template-columns: 1fr;
        }
    }
    
    .category-item {
        display: flex;
        align-items: center;
        background: rgba(255, 255, 255, 0.15);
        padding: 8px 12px;
        border-radius: 6px;
        transition: all 0.2s ease;
    }
    
    .category-item:hover {
        background: rgba(255, 255, 255, 0.25);
    }
    
    .category-checkbox {
        margin-right: 8px;
        cursor: pointer;
        width: 18px;
        height: 18px;
    }
    
    .category-item label {
        font-size: 14px;
        cursor: pointer;
        flex: 1;
    }
    
    .other-category {
        grid-column: 1 / -1;
        display: flex;
        align-items: center;
    }
    
    .other-interests-input {
        flex: 1;
        margin-left: 8px;
        padding: 6px 10px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 4px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
    }
    
    .confirm-categories-btn {
        padding: 8px 16px;
        background: linear-gradient(45deg, #00e5ff, #b400ff);
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 600;
        width: 100%;
        margin-top: 10px;
        transition: all 0.3s ease;
    }
    
    .confirm-categories-btn:hover {
        opacity: 0.9;
        transform: translateY(-2px);
    }
    
    .interests-input {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 4px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        margin-bottom: 10px;
    }
    
    .error-text {
        color: #ff6b6b;
        margin-bottom: 10px;
    }
    
    .follow-up-btn:hover {
        opacity: 0.9;
        transform: translateY(-2px);
    }
    
    /* Budget selector styles */
    .budget-selector-container {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 15px;
        margin-top: 10px;
        margin-bottom: 15px;
    }
    
    .budget-note {
        margin-top: 0;
        margin-bottom: 12px;
        color: white;
    }
    
    .budget-input-container {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        gap: 8px;
    }
    
    .currency-symbol {
        font-weight: bold;
        font-size: 18px;
        color: #00e5ff;
    }
    
    .budget-input {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 4px;
        background: rgba(255, 255, 255, 0.15);
        color: white;
        font-size: 18px;
        text-align: right;
        font-weight: bold;
    }
    
    .budget-input:focus {
        outline: none;
        border-color: #00e5ff;
        box-shadow: 0 0 0 2px rgba(0, 229, 255, 0.3);
    }
    
    .budget-confirm-btn {
        padding: 8px 16px;
        background: linear-gradient(45deg, #00e5ff, #b400ff);
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .budget-confirm-btn:hover {
        opacity: 0.9;
        transform: translateY(-2px);
    }
    
    .budget-slider-container {
        margin-bottom: 15px;
    }
    
    .budget-slider {
        width: 100%;
        height: 8px;
        -webkit-appearance: none;
        background: linear-gradient(90deg, rgba(0, 229, 255, 0.5), rgba(180, 0, 255, 0.5));
        border-radius: 4px;
        outline: none;
        margin-bottom: 8px;
    }
    
    .budget-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #fff;
        cursor: pointer;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        transition: all 0.2s ease;
    }
    
    .budget-slider::-webkit-slider-thumb:hover {
        transform: scale(1.2);
        background: linear-gradient(45deg, #00e5ff, #b400ff);
    }
    
    .budget-range-labels {
        display: flex;
        justify-content: space-between;
        font-size: 12px;
        color: rgba(255, 255, 255, 0.7);
    }
    
    .budget-presets {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin-bottom: 15px;
    }
    
    .budget-preset-btn {
        padding: 8px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 4px;
        color: white;
        cursor: pointer;
        transition: all 0.2s ease;
        text-align: center;
    }
    
    .budget-preset-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
    }
    
    .trip-duration-note {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.8);
        margin-bottom: 0;
        padding-top: 8px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .trip-duration-note span {
        font-weight: bold;
        color: #00e5ff;
    }
`;
document.head.appendChild(datepickerStyles);

        </script>


       
    </body>
</html>